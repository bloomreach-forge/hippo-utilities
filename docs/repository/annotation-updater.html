<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 24 Feb 2017
 | Rendered using Hippo Forge Maven Skin 1.04.00 based on Apache Maven Fluido Skin
-->
<!--[if lt IE 7]><html id="ie6" xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en"><![endif]-->
<!--[if IE 7]><html id="ie7" xmlns="http://www.w3.org/1999/xhtml"  xml:lang="en" lang="en"><![endif]-->
<!--[if IE 8]><html id="ie8" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><![endif]-->
<!--[if IE 9]><html id="ie9" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><![endif]-->
<!--[if !IE]>--><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><!--<![endif]-->

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
                    <meta name="Date-Revision-yyyymmdd" content="20170224"/>
                <meta http-equiv="Content-Language" content="en"/>
        <title>Hippo Forge Utilities plugin - 
    Hippo Utilities Repository - Annotation Base Updater Module</title>
    <link rel="stylesheet" href="../css/forge-maven-skin-syntaxhighlighter-1.04.00.min.css"/>
    <link rel="stylesheet" href="../css/forge-maven-skin-1.04.00.min.css"/>
    <link rel="stylesheet" href="../css/site.css"/>
    <link rel="stylesheet" href="../css/print.css" media="print"/>

        
    <script type="text/javascript" src="../js/forge-maven-skin-syntaxhighlighter-1.04.00.min.js"></script>
    <script type="text/javascript" src="../js/forge-maven-skin-1.04.00.min.js"></script>

    
            </head>
    <body>

        
    
    
    <div class="container-fluid">
        <div class="row-fluid">
            <div id="header">
                <div id="logo">
                    <a href="http://www.onehippo.com">
                        <img src="../images/hipposkin/hippo-logo.png" alt="Hippo Logo" />
                    </a>
                </div>

                <h1>
                                            Hippo Forge Utilities plugin
                    
                </h1>
                <div class="clearfix"></div>
            </div>
        </div>

        <div class="row-fluid">
            <div id="breadcrumbs" class="clearfix">
                <ul class="breadcrumb">
                                
                                        
                            <li id="publishDate">Last Published: 24 Feb 2017</li>
                                                                                                                                                </ul>

                <div class="links">
                    <a href="https://www.onehippo.com">Onehippo.com</a>
                    <a href="https://www.onehippo.org">Onehippo.org</a>
                </div>
            </div>
        </div>



            
    <div class="row-fluid">
        <div id="leftColumn" class="span3">
            <div class="well sidebar-nav">
                <ul class="nav nav-list">
                                        <li class="nav-header">Home</li>
                                                           
        <li>
    
                                                <a href="../index.html" title="Home">
                    <i class="none"></i>
                Home</a>
                    </li>
                               
        <li>
    
                                                <a href="../release-notes.html" title="Release Notes">
                    <i class="none"></i>
                Release Notes</a>
                    </li>
                               
        <li>
    
                                                <a href="../install.html" title="Installation">
                    <i class="none"></i>
                Installation</a>
                    </li>
                                                            <li class="nav-header">Commons module</li>
                                                           
        <li>
    
                                                <a href="../commons/annotationutil.html" title="Annotation Utility">
                    <i class="none"></i>
                Annotation Utility</a>
                    </li>
                               
        <li>
    
                                                <a href="../commons/genericsutil.html" title="Generics Utility">
                    <i class="none"></i>
                Generics Utility</a>
                    </li>
                               
        <li>
    
                                                <a href="../commons/hippoutil.html" title="Hippo Utility">
                    <i class="none"></i>
                Hippo Utility</a>
                    </li>
                               
        <li>
    
                                                <a href="../commons/repositoryutil.html" title="Repository Utility">
                    <i class="none"></i>
                Repository Utility</a>
                    </li>
                               
        <li>
    
                                                <a href="../commons/nodeutil.html" title="Node Utility">
                    <i class="none"></i>
                Node Utility</a>
                    </li>
                               
        <li>
    
                                                <a href="../commons/ftpclient.html" title="FTP Client">
                    <i class="none"></i>
                FTP Client</a>
                    </li>
                               
        <li>
    
                                                <a href="../commons/jcrmockup.html" title="JCR Mockup">
                    <i class="none"></i>
                JCR Mockup</a>
                    </li>
                                                            <li class="nav-header">HST module</li>
                                                           
        <li>
    
                                                <a href="../hst/computil.html" title="CompUtil">
                    <i class="none"></i>
                CompUtil</a>
                    </li>
                               
        <li>
    
                                                <a href="../hst/components.html" title="Components">
                    <i class="none"></i>
                Components</a>
                    </li>
                               
        <li>
    
                                                <a href="../hst/cookie.html" title="Cookie Check">
                    <i class="none"></i>
                Cookie Check</a>
                    </li>
                               
        <li>
    
                                                <a href="../hst/paging.html" title="Paging">
                    <i class="none"></i>
                Paging</a>
                    </li>
                               
        <li>
    
                                                <a href="../hst/xmlstripper.html" title="XMLStripper">
                    <i class="none"></i>
                XMLStripper</a>
                    </li>
                                                            <li class="nav-header">Repository module</li>
                                                           
        <li>
    
                                                <a href="../repository/base-updater.html" title="Base Updater Module">
                    <i class="none"></i>
                Base Updater Module</a>
                    </li>
                               
        <li class="active">
    
                        <a href="#"><i class="none"></i>Annotation Base Updater Module</a>
                </li>
                                                            <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
        <li>
    
                                                <a href="../project-info.html" title="Project Information">
                    <i class="icon-chevron-right"></i>
                Project Information</a>
                                </li>
                                                                                                                                                                                                           
        <li>
    
                                                <a href="../project-reports.html" title="Project Reports">
                    <i class="icon-chevron-right"></i>
                Project Reports</a>
                                </li>
                        </ul>

                
                <hr class="divider"/>

                <div id="poweredBy">
                                            <div class="clear"></div>
                                            <div class="clear"></div>
                                            <div class="clear"></div>
                                                <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
            <img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png"/>
        </a>
                            </div>
            </div>
        </div>
    
        
        <div id="bodyColumn"  class="span9" >
                                
            <!-- Copyright 2012-2013 Hippo B.V. (http://www.onehippo.com)

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License. -->
  
    <p style="color:red">
      <b>Updater modules have been deprecated in the repository, use
        <a class="externalLink" href="http://www.onehippo.org/library/concepts/update/using-the-updater-editor.html">Updater scripts</a>
        instead.
      </b>
    </p>
    
<div class="section">
<h2>Annotation Base Updater Module<a name="Annotation_Base_Updater_Module"></a></h2>
      
<div class="section">
<h3>AnnotationBaseUpdater implements UpdaterModule<a name="AnnotationBaseUpdater_implements_UpdaterModule"></a></h3>
        
<p>
          AnnotationBaseUpdater supports @Updater, @PathVisitor and @QueryVisitor
          for your convenience. So you can easily implement your custom updater
          only by using annotations!
        </p>
        
<p>
          <i>Note: you may read the articles in the <a href="#References">References</a> for detail about the concept of UpdaterModule itself.</i>
        </p>
        
<p>
          You may define @PathVisitor or/and @QueryVisitor in any methods
          which should be public and have only one parameter of javax.jcr.Node type.
        </p>
        
<p>
          Here is a simple example:
        </p>
        
<div class="source"><pre class="prettyprint linenums">
@Updater(name = &quot;Updater-demosite-2.05.00&quot;,
        start = { &quot;demosite-2.04.00&quot; },
        end = { &quot;demosite-2.05.00&quot; })
public class Updater_2_05_00 extends AnnotationBaseUpdater {

    @PathVisitor(
            paths={
                    &quot;/hippo:configuration/hippo:initialize/hippo-namespaces-demosite-comment&quot;,
                    &quot;/hippo:configuration/hippo:initialize/demosite-sitemap&quot;
                }
            )
    public void deleteInitializeNodes(Node node) throws RepositoryException { node.remove(); }

    @PathVisitor(
            paths={
                    &quot;/hippo:namespaces/demosite/comment&quot;,
                    &quot;/hst:hst/hst:configurations/demosite/hst:sitemap&quot;
                }
            )
    public void deleteNamespaceConfigurationNodes(Node node) throws RepositoryException { node.remove(); }
}
        </pre></div>
        
<p>
          In the example above, the updater class defines its name and start/end version tags.
          So, the updater will run on the system having 'demosite-2.04.00' value in '/hippo:configuration/hippo:initialize' node.
          After running the updater, the repository will have a new tag version, 'demosite-2.05.00' value in the node.
        </p>
        
<p>
          The example updater implementation shown above defines two methods, both of which must be public and have only one javax.jcr.Node type argument.
          The first method, #deleteInitializeNodes(Node), is annotated by @PathVisitor, so AnnotationBaseUpdater will automatically register visitors by the paths
          and the visitors will invoke the #deleteInitializeNodes(Node) automatically.
          In the example, it just removes the visiting nodes in order to re-initialize the initialize items.
        </p>
        
<p>
          Also, the #deleteNamespaceConfigurationNodes(Node) method defines @PathVisitor annotation as well in order to remove namespace nodes and configuration nodes.
          Anyway, you can define any methods with @PathVisitor or @QueryVisitor. AnnotationBaseUpdater will register visitors to invoke your methods automatically.
        </p>
      </div>
      
<div class="section">
<h3>Annotations in Detail<a name="Annotations_in_Detail"></a></h3>
        
<p>
          All annotation types are defined in &quot;org.onehippo.forge.utilities.repository.updater.annotations&quot; package.
        </p>
        
<table border="0" class="table table-striped">
          
<tr class="a">
            
<th>Annotation Type</th>
            
<th>Element</th>
            
<th>Description</th>
            
<th>Required?</th>
            
<th>Example Value</th>
            
<th>Default Value</th>
          </tr>
          
<tr class="b">
            
<td>Updater</td>
            
<td></td>
            
<td>Updater marker annotation for your class</td>
            
<td>Yes</td>
            
<td></td>
            
<td></td>
          </tr>
          
<tr class="a">
            
<td>Updater</td>
            
<td>name</td>
            
<td>
              The name of your updater.
              This value is used to invoke UpdaterContext#registerName(name);
            </td>
            
<td>Yes</td>
            
<td></td>
            
<td></td>
          </tr>
          
<tr class="b">
            
<td>Updater</td>
            
<td>start</td>
            
<td>
              The start tags of your updater.
              This value is type of String array.
              Each item of this value is used to invoke UpdaterContext#registerStartTag(tag);
              <br />
              The start tag values define the previous tag values in your repository.
              If your repository has any of the start tag value, then your updater will run.
              <br />
              So, in order to run your updater, the repository should already have any of the start tags.
            </td>
            
<td>Yes</td>
            
<td>demosite-2.04.00</td>
            
<td></td>
          </tr>
          
<tr class="a">
            
<td>Updater</td>
            
<td>end</td>
            
<td>
              The end tags of your updater.
              This value is type of String array.
              Each item of this value is used to invoke UpdaterContext#registerEndTag(tag);
              <br />
              The end tag values define the new tag values for your repository.
              After the updater runs successfully, your repository will have new tag values by this end tag values.
            </td>
            
<td>Yes</td>
            
<td>demosite-2.05.00</td>
            
<td></td>
          </tr>
          
<tr class="b">
            
<td>Updater</td>
            
<td>before</td>
            
<td>
              The before values define the execution orders among updaters.
              This value is type of String array.
              Each item of this value is used to invoke UpdaterContext#registerBefore(value);
              <br />
              If you want to run your updater before some updaters from other plugins or modules,
              then you may set before values to the names of other updater modules.
            </td>
            
<td>No</td>
            
<td>Updater-plugin1-1.02.01</td>
            
<td></td>
          </tr>
          
<tr class="a">
            
<td>Updater</td>
            
<td>after</td>
            
<td>
              The after values define the execution orders among updaters, too.
              This value is type of String array.
              Each item of this value is used to invoke UpdaterContext#registerAfter(value);
              <br />
              If you want to run your updater after some updaters from other plugins or modules,
              then you may set after values to the names of other updater modules.
            </td>
            
<td>No</td>
            
<td>Updater-plugin2-2.01.00</td>
            
<td></td>
          </tr>
          
<tr class="b">
            
<td>PathVisitor</td>
            
<td></td>
            
<td>
              Annotation enabling to iterate all nodes by the specified path.
              Your methods with this annotation must have only one argument
              which is type of javax.jcr.Node.
            </td>
            
<td></td>
            
<td></td>
            
<td></td>
          </tr>
          
<tr class="a">
            
<td>PathVisitor</td>
            
<td>paths</td>
            
<td>
              The path array value.
              Each of path values will be used to register path visitors.
              Path visitors are internally created to invoke your annotated method with
              the visiting javax.jcr.Node instance argument.
            </td>
            
<td>Yes</td>
            
<td>
              {
                &quot;/hippo:configuration/hippo:initialize/hippo-namespaces-demosite-comment&quot;,
                &quot;/hippo:configuration/hippo:initialize/demosite-sitemap&quot;
              }
            </td>
            
<td></td>
          </tr>
          
<tr class="b">
            
<td>QueryVisitor</td>
            
<td></td>
            
<td>
              Annotation enabling to iterate all nodes by the specified query statements.
              Your methods with this annotation must have only one argument
              which is type of javax.jcr.Node.
            </td>
            
<td></td>
            
<td></td>
          </tr>
          
<tr class="a">
            
<td>QueryVisitor</td>
            
<td>language</td>
            
<td>
              The language value for the query statements.
            </td>
            
<td>No</td>
            
<td>&quot;xpath&quot;, &quot;sql&quot;, etc.</td>
            
<td>&quot;xpath&quot;</td>
          </tr>
          
<tr class="b">
            
<td>QueryVisitor</td>
            
<td>queries</td>
            
<td>
              The query statement array value.
              Each of query statement values will be used to register query visitors.
              Query visitors are internally created to invoke your annotated method with
              the visiting javax.jcr.Node instance argument.
            </td>
            
<td>Yes</td>
            
<td>
              {
                &quot;//some/ad-hoc/path/to/delete[@tag='something']&quot;,
                &quot;//some/ad-hoc/path/to/delete[content:block/@color='green']&quot;
              }
            </td>
            
<td></td>
          </tr>
        </table>
      </div>
      
<div class="section">
<h3>UpdaterUtils helps you to work with JCR Nodes<a name="UpdaterUtils_helps_you_to_work_with_JCR_Nodes"></a></h3>
        
<p>
          Also, for advanced usages, you may also use UpdaterUtils class
          which provides the following utility methods. Please see javadoc for more detail.
        </p>
        
<div class="source"><pre class="prettyprint linenums">
public class UpdaterUtils {

    public static void removeSubNode(Node node, String name);
    public static void removeProperty(Node node, String property);
    public static String getProperty(Node node, String property);
    public static String getUUID(Node node);

    public static Node setHSTPage(Node node, String name, String referenceComponent, String template);
    public static Node setHSTTemplate(Node node, String name, String renderPath);
    public static Node setHSTComponent(Node node, String name, String componentClassName,
                                       String template, String[] parameterNames, String[] parameterValues);
    public static Node setHSTSitemapItem(Node node, String name, String componentConfigurationId,
                                         String relContentPath);
    public static Node setHSTSitemenu(Node node, String name);
    public static Node setHSTSitemenuItem(Node node, String name, String referenceSitemapItem);
    public static void setHSTParameterNamesValues(Node node, String[] parameterNames, String[] parameterValues);

    public static void setPropertyNode(Node propertiesDoc, String propName, String propValue);
    public static void removePropertyNode(Node propertiesDoc, String propName);

    public static Node getFolder(Node node, String folderName);
    public static Node createFolder(Node node, String folderName);
    public static Node createFolder(Node node, String folderName, String[] folderTypes);
    public static String[] getDefaultFolderTypes();

}
        </pre></div>
      </div>
      
<div class="section">
<h3>References<a name="References"></a></h3>
        
<ul>
          
<li><a class="externalLink" href="https://wiki.onehippo.com/display/CMS7/Upgrading+and+updating">Upgrading and updating</a></li>
          
<li><a class="externalLink" href="http://blog.jeroenreijn.com/2010/06/introduction-to-hippo-cms-7-updater.html">An introduction to Hippo CMS 7 updater modules</a></li>
        </ul>
      </div>
    </div>
  

            </div>
        </div>
    </div>

    <hr/>

    <footer>
                <div class="container-fluid">
                <div class="row span12">Copyright &copy;                                                2011-2017
                                            <a href="http://www.onehippo.com/">Hippo B.V. (http://www.onehippo.com)</a>.
                        All Rights Reserved.            
                                        
            </div>

        
        
                </div>
    </footer>
</body>
</html>
